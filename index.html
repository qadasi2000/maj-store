<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø§Ø¬Ø¯ Ultra V15.6 Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        /* Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø¨Ø³ÙŠØ·Ø© Ù„Ø²Ø± Ø§Ù„Ø±ÙØ¶ */
        :root { 
            --main: #3d0016; --gold: #f9d976; --gold-dark: #d4af37;
            --success: #00ff88; --pending: #ffb300; --error: #ff4b2b; 
            --bg: #0f0006; --card-bg: rgba(255, 255, 255, 0.07);
        }
        /* ... (Ù†ÙØ³ ØªÙ†Ø³ÙŠÙ‚Ø§ØªÙƒ Ø§Ù„Ø±Ø§Ø¦Ø¹Ø©) ... */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; font-family: 'Cairo', sans-serif; margin: 0; min-height: 100vh; }
        .app { max-width: 480px; margin: 0 auto; padding: 15px; padding-bottom: 90px; }
        .card { background: var(--card-bg); border-radius: 25px; padding: 20px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(10px); }
        .bal-box { text-align: center; padding: 25px 10px; background: linear-gradient(135deg, #5d001e 0%, #1a000a 100%); border-radius: 30px; border: 1px solid var(--gold-dark); margin-bottom: 20px; }
        .bal-val { font-size: 2.8rem; font-weight: 900; color: var(--gold); }
        .btn { width: 100%; padding: 14px; border-radius: 15px; border: none; font-weight: 700; cursor: pointer; background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%); color: #3d0016; }
        .nav-bottom { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 480px; background: #0f0006; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid var(--gold-dark); }
        .hidden { display: none !important; }
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 12px; z-index: 9999; display: none; }
    </style>
</head>
<body>

<div id="loader" style="position: fixed; inset: 0; background: rgba(15,0,6,0.9); z-index: 9999; display:none; flex-direction: column; align-items: center; justify-content: center;">
    <div style="border: 4px solid #333; border-top: 4px solid var(--gold); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite;"></div>
</div>

<div id="toast"></div>

<div class="app">
    <div id="page-auth">
        <div style="text-align:center; padding: 40px 0;">
            <h1 style="color:var(--gold); font-size:2.8rem; margin:0;">Ø§Ù„Ù…Ø§Ø¬Ø¯ ğŸ’</h1>
            <p style="opacity:0.6;">ULTRA V15.6</p>
        </div>
        <div class="card">
            <input type="text" id="auth-user" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
            <input type="password" id="auth-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button class="btn" onclick="handleAuth(this)">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="page-main" class="hidden">
        <div class="bal-box">
            <small id="user-display"></small>
            <div class="bal-val" id="bal-display">0.00</div>
            <small>Ø±ÙŠØ§Ù„</small>
        </div>

        <div id="admin-area" class="hidden">
            <div class="admin-tabs" style="display:flex; gap:5px; margin-bottom:15px;">
                <button class="btn" onclick="switchAdminTab('requests')">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                <button class="btn" onclick="switchAdminTab('inventory')">Ø§Ù„Ù…Ø®Ø²Ù†</button>
            </div>
            <div id="admin-requests">
                <div id="admin-pending-list"></div>
            </div>
        </div>

        <div id="sec-topup" class="sec hidden">
            <div class="card">
                <h3 style="text-align:center; color:var(--gold);">Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯</h3>
                <input type="number" id="top-amt" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº">
                <input type="text" id="top-ref" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹">
                <button class="btn" id="btn-request-topup" onclick="topupRequest(this)">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                <p id="pending-msg" class="hidden" style="color:var(--pending); font-size:0.8rem; text-align:center; margin-top:10px;">
                    Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..
                </p>
            </div>
            <div id="logs-list"></div>
        </div>
        
        </div>
</div>

<div class="nav-bottom hidden" id="main-nav">
    <div class="nav-item active" onclick="switchSec('store')">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</div>
    <div class="nav-item" onclick="switchSec('topup'); loadLogs()">â• Ø´Ø­Ù†</div>
</div>

<script>
    const API = 'ØªØ£ÙƒØ¯_Ù…Ù†_ÙˆØ¶Ø¹_Ø±Ø§Ø¨Ø·_Ø§Ù„Ù€_API_Ø§Ù„Ø®Ø§Øµ_Ø¨Ùƒ_Ù‡Ù†Ø§';
    let myUser = "", myPass = "", isAdmin = false, hasPendingOrder = false;

    // 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù…Ø¹ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ© ÙˆÙØ­Øµ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
    async function handleAuth(btn) {
        const u = document.getElementById('auth-user').value;
        const p = document.getElementById('auth-pass').value;
        loading(true);
        try {
            const res = await fetch(`${API}?action=getWallet&id=${u}&password=${p}`).then(r => r.json());
            if(res.success) {
                myUser = u; myPass = p;
                isAdmin = res.isAdmin || (u === "777216718");
                document.getElementById('page-auth').classList.add('hidden');
                document.getElementById('page-main').classList.remove('hidden');
                document.getElementById('main-nav').classList.remove('hidden');
                document.getElementById('bal-display').innerText = res.balance;
                
                showT("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ ÙÙŠ Ù…Ø­ÙØ¸Ø© Ø§Ù„Ù…Ø§Ø¬Ø¯! ğŸ’"); // Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ©
                
                if(isAdmin) { 
                    document.getElementById('admin-area').classList.remove('hidden'); 
                    fetchAdminOrders(); 
                }
                
                checkUserPendingStatus(); // ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙÙˆØ±Ø§Ù‹
            } else {
                showT(res.msg, true);
            }
        } catch(e) { showT("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„", true); }
        loading(false);
    }

    // 2. ÙØ­Øµ Ù‡Ù„ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø·Ù„Ø¨ Ù…Ø¹Ù„Ù‚ ÙÙŠ Ø§Ù„Ø´ÙŠØª
    async function checkUserPendingStatus() {
        try {
            const res = await fetch(`${API}?action=getOrders&id=${myUser}`).then(r => r.json());
            if(res.success) {
                // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø¹Ù† Ø£ÙŠ Ø­Ø§Ù„Ø© "Pending" Ø£Ùˆ "Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±"
                hasPendingOrder = res.orders.some(o => o.status.includes("Pending") || o.status.includes("Ù‚ÙŠØ¯"));
                updateTopupUI();
            }
        } catch(e) {}
    }

    function updateTopupUI() {
        const btn = document.getElementById('btn-request-topup');
        const msg = document.getElementById('pending-msg');
        if(hasPendingOrder) {
            btn.disabled = true;
            btn.style.opacity = "0.5";
            msg.classList.remove('hidden');
        } else {
            btn.disabled = false;
            btn.style.opacity = "1";
            msg.classList.add('hidden');
        }
    }

    // 3. Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø´Ø­Ù† Ù…Ø¹ Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
    async function topupRequest(btn) {
        if(hasPendingOrder) return showT("Ù„Ø¯ÙŠÙƒ Ø·Ù„Ø¨ Ù…Ø¹Ù„Ù‚ Ø¨Ø§Ù„ÙØ¹Ù„", true);
        
        const amt = document.getElementById('top-amt').value;
        const ref = document.getElementById('top-ref').value;
        if(!amt || !ref) return showT("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", true);

        loading(true);
        try {
            const res = await fetch(`${API}?action=requestTopup&id=${myUser}&amount=${amt}&ref=${ref}`).then(r => r.json());
            showT(res.msg);
            if(res.success) {
                hasPendingOrder = true;
                updateTopupUI();
                loadLogs();
            }
        } catch(e) { showT("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„", true); }
        loading(false);
    }

    // 4. Ø¬Ù„Ø¨ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± (Ù…ÙˆØ§ÙÙ‚Ø© / Ø±ÙØ¶)
    async function fetchAdminOrders() {
        const list = document.getElementById('admin-pending-list');
        try {
            const res = await fetch(`${API}?action=getAdminOrders&adminPass=${myPass}`).then(r => r.json());
            if(res.success && res.orders.length > 0) {
                list.innerHTML = res.orders.map(o => `
                    <div class="card" style="margin-bottom:10px; border-right:5px solid var(--pending);">
                        <div style="font-size:0.85rem;"><b>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</b> ${o.user}</div>
                        <div style="font-size:1.1rem; color:var(--gold); font-weight:bold;">${o.amount} Ø±ÙŠØ§Ù„</div>
                        <div style="font-size:0.7rem; opacity:0.7;">Ø§Ù„Ù…Ø±Ø¬Ø¹: ${o.ref}</div>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <button class="btn" style="background:var(--success); color:#000; flex:1;" onclick="processAdminOrder(${o.row}, 'approve')">Ù…ÙˆØ§ÙÙ‚Ø©</button>
                            <button class="btn" style="background:var(--error); color:#fff; flex:1;" onclick="processAdminOrder(${o.row}, 'reject')">Ø±ÙØ¶</button>
                        </div>
                    </div>
                `).join('');
            } else {
                list.innerHTML = "<p style='text-align:center; opacity:0.5;'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</p>";
            }
        } catch(e) {}
    }

    async function processAdminOrder(row, type) {
        loading(true);
        const action = type === 'approve' ? 'adminApprove' : 'adminReject';
        try {
            const res = await fetch(`${API}?action=${action}&row=${row}&adminPass=${myPass}`).then(r => r.json());
            showT(res.msg);
            fetchAdminOrders(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙˆØ±Ø§Ù‹
        } catch(e) { showT("ÙØ´Ù„ ØªÙ†ÙÙŠØ° Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡", true); }
        loading(false);
    }

    // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©
    function showT(m, err=false) { 
        const t = document.getElementById('toast'); t.innerText = m; 
        t.style.display = "block"; t.style.background = err ? "var(--error)" : "var(--gold)";
        setTimeout(() => t.style.display = "none", 3000); 
    }
    function loading(s) { document.getElementById('loader').style.display = s ? "flex" : "none"; }
    function switchSec(id) { document.querySelectorAll('.sec').forEach(s => s.classList.add('hidden')); document.getElementById('sec-'+id).classList.remove('hidden'); }
</script>
</body>
</html>
